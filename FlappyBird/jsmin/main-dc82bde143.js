!function(){var t=window.Background=function(){this.image=game.R.bg_day,this.x=0,this.y=.75*game.canvas.height-396,this.w=288,this.h=512,this.speed=1};t.prototype.update=function(){this.x-=this.speed,this.x<-this.w&&(this.x=0)},t.prototype.render=function(){game.ctx.drawImage(this.image,this.x,this.y),game.ctx.drawImage(this.image,this.x+this.w,this.y),game.ctx.drawImage(this.image,this.x+2*this.w,this.y),game.ctx.fillStyle="#4ec0ca",game.ctx.fillRect(0,0,game.canvas.width,this.y+10)}}(),function(){var t=window.Bird=function(){this.color=parseInt(3*Math.random()),this.image=[game.R["bird"+this.color+"_0"],game.R["bird"+this.color+"_1"],game.R["bird"+this.color+"_2"]],this.wing=0,this.x=.382*game.canvas.width-24,this.y=100,this.speed=1,this.isClick=!1,this.d=0};t.prototype.update=function(){this.speed++,this.d<1.58&&(this.d+=.04),this.isClick?(this.y-=.4*(20-this.speed),20<this.speed&&(this.isClick=!1,this.speed=0)):this.y+=.4*this.speed,this.wingStep(),this.T=this.y-12,this.R=this.x+17,this.B=this.y+12,this.L=this.x-17,this.y<0&&(this.y=0),this.B>.78*game.canvas.height&&game.sm.enter(4)},t.prototype.render=function(){game.ctx.save(),game.ctx.translate(this.x,this.y),game.ctx.rotate(this.d),game.ctx.drawImage(this.image[this.wing],-24,-24),game.ctx.restore()},t.prototype.fly=function(){this.isClick=!0,this.speed=0,this.d=-.6},t.prototype.wingStep=function(){game.fno%10==0&&this.wing++,2<this.wing&&(this.wing=0)}}(),function(){var t=window.Game=function(t){this.canvas=document.getElementById(t.id),this.ctx=this.canvas.getContext("2d"),this.Rjsonurl=t.Rjsonurl,this.fno=0,this.init();var e=this;this.loadAllResource(function(){e.start()})};t.prototype.init=function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;414<t?t=414:t<320&&(t=320),680<e?e=680:e<500&&(e=500),this.canvas.width=t,this.canvas.height=e},t.prototype.loadAllResource=function(i){this.R={};var a=this,s=0,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)for(var t=JSON.parse(n.responseText),e=0;e<t.images.length;e++)a.R[t.images[e].name]=new Image,a.R[t.images[e].name].src=t.images[e].url,a.R[t.images[e].name].onload=function(){s++,a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.ctx.font="20px 楷体",a.ctx.textAlign="center",a.ctx.fillText("正在加载第"+s+"/"+t.images.length+"项，请稍后！",a.canvas.width/2,.382*a.canvas.height),s===t.images.length&&i()}},n.open("get",this.Rjsonurl,!0),n.send(null)},t.prototype.start=function(){var t=this;this.sm=new SceneManager,this.timer=setInterval(function(){t.fno++,t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.sm.update(),t.sm.render(),t.ctx.font="16px 微软雅黑",t.ctx.textAlign="left",t.ctx.fillStyle="black",t.ctx.fillText("FNO:"+t.fno,10,20),t.ctx.fillText("场景:"+t.sm.sceneNum,10,40)},20)}}(),function(){var t=window.Land=function(){this.image=game.R.land,this.x=0,this.y=.78*game.canvas.height,this.w=336,this.h=112,this.speed=2};t.prototype.update=function(){this.x-=this.speed,this.x<-this.w&&(this.x=0)},t.prototype.render=function(){game.ctx.drawImage(this.image,this.x,this.y),game.ctx.drawImage(this.image,this.x+this.w,this.y),game.ctx.drawImage(this.image,this.x+2*this.w,this.y),game.ctx.fillStyle="#ded895",game.ctx.fillRect(0,this.y+this.h-1,game.canvas.width,game.canvas.height-this.y-this.h+1)}}(),function(){var t=window.Pipe=function(){this.imageup=game.R.pipe_up,this.imagedown=game.R.pipe_down,this.interSpace=130,this.upHeight=parseInt(200*Math.random())+100,this.downHeight=.78*game.canvas.height-this.upHeight-this.interSpace,this.X=game.canvas.width,this.alreadyPass=!1,game.pipeArr.push(this)};t.prototype.update=function(){if(this.X-=2,game.bird.R>this.X&&game.bird.L<this.X+52&&(game.bird.T<this.downHeight||game.bird.B>this.downHeight+this.interSpace)&&game.sm.enter(4),game.bird.R>this.X+52&&!this.alreadyPass&&(game.score++,this.alreadyPass=!0),this.X<-52)for(var t=0;t<game.pipeArr.length;t++)game.pipeArr[t]===this&&game.pipeArr.splice(t,1)},t.prototype.render=function(){game.ctx.drawImage(this.imageup,0,0,52,this.upHeight,this.X,this.interSpace+this.downHeight,52,this.upHeight),game.ctx.drawImage(this.imagedown,0,320-this.downHeight,52,this.downHeight,this.X,0,52,this.downHeight)}}(),function(){var t=window.SceneManager=function(){this.sceneNum=1,game.bg=new Background,game.land=new Land,game.bird=new Bird,this.title=game.R.title,this.titleY=-50,this.btn_play=game.R.btn_play,this.btnX=game.canvas.width/2-58,this.btnY=game.canvas.height,this.bindEvent()};t.prototype.update=function(){switch(this.sceneNum){case 1:this.titleY+=8,120<this.titleY&&(this.titleY=120),this.btnY-=15,this.btnY<320&&(this.btnY=320);break;case 2:game.bird.wingStep(),this.opacityIsDown?this.tutorialOpacity-=.02:this.tutorialOpacity+=.02,(this.tutorialOpacity<.02||.98<this.tutorialOpacity)&&(this.opacityIsDown=!this.opacityIsDown);break;case 3:game.bird.update(),game.bg.update(),game.land.update(),game.fno%150==0&&new Pipe;for(var t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].update();break;case 4:this.gamefno++,game.bird.y>.78*game.canvas.height-17&&(this.toLand=!0),this.toLand?game.fno%10==0&&this.boomNum++:(game.bird.y+=.8*this.gamefno,game.bird.d=1),this.maskOpacity-=.1,this.maskOpacity<0&&(this.maskOpacity=0)}},t.prototype.render=function(){switch(this.sceneNum){case 1:game.bg.render(),game.land.render(),game.bird.render(),game.bird.x=game.canvas.width/2,game.bird.y=220,game.ctx.drawImage(this.title,game.canvas.width/2-89,this.titleY),game.ctx.drawImage(this.btn_play,this.btnX,this.btnY);break;case 2:game.bg.render(),game.land.render(),game.bird.render(),game.ctx.save(),game.ctx.globalAlpha=this.tutorialOpacity,game.ctx.drawImage(game.R.tutorial,game.canvas.width/2-57,200),game.ctx.restore();break;case 3:game.bg.render(),game.land.render(),game.bird.render();for(var t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();var e=game.score.toString().length;for(t=0;t<e;t++)game.ctx.drawImage(game.R["num"+game.score.toString().charAt(t)],game.canvas.width/2-e/2*34+34*t,60);break;case 4:game.bg.render(),game.land.render();for(t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();this.toLand?this.boomNum<=2?game.ctx.drawImage(game.R["boom"+this.boomNum],game.bird.x-48,game.bird.y-48):this.enter(5):game.bird.render(),game.ctx.fillStyle="rgba(255, 255, 255,"+this.maskOpacity+")",game.ctx.fillRect(0,0,game.canvas.width,game.canvas.height);for(e=game.score.toString().length,t=0;t<e;t++)game.ctx.drawImage(game.R["num"+game.score.toString().charAt(t)],game.canvas.width/2-e/2*34+34*t,60);break;case 5:game.bg.render(),game.land.render();for(t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();for(e=game.score.toString().length,t=0;t<e;t++)game.ctx.drawImage(game.R["num"+game.score.toString().charAt(t)],game.canvas.width/2-e/2*34+34*t,60);game.ctx.drawImage(game.R.gameOver,game.canvas.width/2-102,200)}},t.prototype.enter=function(t){switch(this.sceneNum=t,this.sceneNum){case 1:this.titleY=-50,this.btnY=game.canvas.height,game.bird=new Bird;break;case 2:game.bird.y=100,this.tutorialOpacity=1,this.opacityIsDown=!0;break;case 3:game.bird.x=.382*game.canvas.width-24,game.pipeArr=new Array,game.score=0;break;case 4:this.maskOpacity=1,this.toLand=!1,this.gamefno=0,this.boomNum=0}},t.prototype.bindEvent=function(){var i=this;game.canvas.addEventListener("touchstart",function(t){t.preventDefault();var e=t.touches[0];!function(t,e){switch(i.sceneNum){case 1:t>i.btnX&&t<i.btnX+116&&e>i.btnY&&e<i.btnY+70&&i.enter(2);break;case 2:i.enter(3);break;case 3:game.bird.fly();break;case 5:i.enter(1)}}(e.clientX,e.clientY)},!0)}}();